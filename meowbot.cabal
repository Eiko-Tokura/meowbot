cabal-version:      2.4

-- Initial package description 'meowbot.cabal' generated by
-- 'cabal init'. For further documentation, see:
--   http://haskell.org/cabal/users-guide/
--
-- The name of the package.
name:               meowbot

-- The package version.
-- See the Haskell package versioning policy (PVP) for standards
-- guiding when and how versions should be incremented.
-- https://pvp.haskell.org
-- PVP summary:      +-+------- breaking API changes
--                   | | +----- non-breaking API additions
--                   | | | +--- code changes with no API change
version:             0.4.2.0

-- A short (one-line) description of the package.
synopsis:           demo

-- A longer description of the package.
-- description:

-- URL for the project homepage or repository.
homepage:

-- A URL where users can report bugs.
-- bug-reports:

-- The license under which the package is released.
license:            NONE

-- The package author(s).
author:             eiko

-- An email address to which users can send suggestions, bug reports, and patches.
maintainer:         754829466@qq.com

-- A copyright notice.
-- copyright:
-- category:

-- Extra files to be distributed with the package, such as examples or a README.
extra-source-files: CHANGELOG.md

tested-with: GHC == 9.2.8, GHC == 9.10.1

library item

    exposed-modules: Control.Monad.Item
                   , Parser.Char
                   , Parser.String
                   , Parser.Definition
                   , Parser.Except
                   , Parser.Run
                   , Parser.Template
                   , Parser.Text

-- -ddump-simpl -ddump-to-file -ddump-simpl-stats -ddump-inlinings -ddump-rule-firings -ddump-rule-rewrites -dsuppress-all  
    ghc-options: +RTS -A128m -AL512m -RTS -Wall -Werror=missing-fields -Wno-name-shadowing -Wno-missing-signatures -Wno-unused-do-bind -Wno-unticked-promoted-constructors -O2    -finline-generics-aggressively -fspecialize-aggressively -fexpose-all-unfoldings -funfolding-use-threshold=256 -threaded -finfo-table-map -fdistinct-constructor-tables -j8

    build-depends: base  >=4.7 && <5
                 , mtl
                 , transformers
                 , text
                 , template-haskell

    hs-source-dirs:   item

    default-language: GHC2024


library meowbot-lib
    -- .hs or .lhs file containing the Main module.

-- -ddump-simpl -ddump-to-file -ddump-simpl-stats -ddump-inlinings -ddump-rule-firings -ddump-rule-rewrites -dsuppress-all 
    ghc-options: +RTS -A128m -AL512m -RTS -Wall -Werror=missing-fields -Werror=missing-methods -Wno-name-shadowing -Wno-missing-signatures -Wno-unused-do-bind -Wno-unticked-promoted-constructors -O1 -threaded -j8
    -- -finline-generics-aggressively -fspecialize-aggressively -fexpose-all-unfoldings -funfolding-use-threshold=512 -finfo-table-map -fdistinct-constructor-tables -j8

    -- Modules included in this executable, other than Main.
    exposed-modules: Command
                   , Command.Aokana
                   , Command.Aokana.Scripts
                   , Command.Cat
                   , Command.Cat.CatSet
                   , Command.Chat
                   , Command.Hangman
                   , Command.Hangman.Data
                   , Command.Hangman.Model
                   , Command.Hangman.Ranking
                   , Command.Help
                   , Command.Md
                   , Command.Poll
                   , Command.Poll.PollData
                   , Command.Random
                   , Command.Retract
                   , Command.SetSysMessage
                   , Command.Study
                   , Command.User
                   , Control.Monad.Effect
                   , Control.Monad.ExceptionReturn
                   , Control.Monad.IOe
                   , Control.Monad.MaybeHints
                   , Control.Monad.Readable
                   , Control.Monad.Trans.ReaderState
                   , Data.Additional
                   , Data.Additional.Default
                   , Data.Additional.Saved
                   , Data.FilePathFor
                   , Data.HList
                   , Data.Maybe.Union
                   , Data.PersistModel
                   , Data.Template
                   , External.ChatAPI
                   , External.ChatAPI.Function
                   , External.ChatAPI.MeowTool
                   , External.ChatAPI.MeowToolEnv
                   , External.ChatAPI.Tool
                   , External.MarkdownImage
                   , External.ProxyWS
                   , MeowBot
                   , MeowBot.Action
                   , MeowBot.Async
                   , MeowBot.BotStructure
                   , MeowBot.CQCode
                   , MeowBot.CommandRule
                   , MeowBot.Data
                   , MeowBot.Data.Book
                   , MeowBot.GetInfo
                   , MeowBot.MetaMessage
                   , MeowBot.Parser
                   , MeowBot.Update
                   , Module
                   , Module.Async
                   , Module.AsyncInstance
                   , Module.Command
                   , Module.CommandInstance
                   , Module.ConnectionManager
                   , Module.LogDatabase
                   , Module.ProxyWS
                   , Probability.Foundation
                   , System
                   , System.Cat
                   , System.General
                   , System.Logging
                   , System.Meow
                   , Utils.Base64
                   , Utils.ByteString
                   , Utils.Logging
                   , Utils.Maybe
                   , Utils.Persist
                   , Utils.RunDB
                   , Utils.Text
                   --, External.ChatAPI.Tool.Search

    -- LANGUAGE extensions used by modules in this package.
    -- other-extensions:

    -- Other library packages from which modules are imported.
    --  build-depends:    base ^>=4.16.4.0
    build-depends: base >=4.7 && <5
                 , aeson
                 , async
                 , base64-bytestring
                 , bytestring
                 , containers
                 , data-default
                 , deepseq
                 , directory
                 , filepath
                 , http-client
                 , http-client-tls
                 , http-types
                 , item
                 , lens
                 , monad-logger
                 , mtl
                 , parallel
                 , persistent
                 , persistent-sqlite
                 , persistent-template
                 , process
                 , random
                 , resource-pool
                 , safe
                 , servant
                 , servant-client
                 , stm
                 , tasty
                 , template-haskell
                 , text
                 , time
                 , transformers
                 , unliftio-core
                 , vector
                 , websockets
                 , wuss
    -- Directories containing source files.
    hs-source-dirs:   src

    default-language: GHC2024

    default-extensions: OverloadedStrings, TypeFamilies

executable meowbot
    main-is:          Main.hs

-- -ddump-simpl -ddump-to-file -ddump-simpl-stats -ddump-inlinings -ddump-rule-firings -ddump-rule-rewrites -dsuppress-all
    ghc-options: +RTS -A128m -AL512m -RTS -Wall -Werror=missing-fields -Wno-name-shadowing -Wno-missing-signatures -Wno-unused-do-bind -Wno-unticked-promoted-constructors -O2 -threaded -rtsopts -finline-generics-aggressively -fspecialize-aggressively -with-rtsopts=-N -with-rtsopts=-F2 -with-rtsopts=-Fd2 -fexpose-all-unfoldings -funfolding-use-threshold=256 -finfo-table-map -fdistinct-constructor-tables  -j8 -with-rtsopts=-Iw60 -with-rtsopts=-A10m

    hs-source-dirs:   app

    build-depends: base
                 , meowbot-lib
                 , aeson
                 , async
                 , base64-bytestring
                 , bytestring
                 , containers
                 , data-default
                 , deepseq
                 , directory
                 , filepath
                 , http-client
                 , http-client-tls
                 , http-types
                 , item
                 , lens
                 , monad-logger
                 , mtl
                 , parallel
                 , persistent
                 , persistent-sqlite
                 , persistent-template
                 , process
                 , random
                 , resource-pool
                 , safe
                 , servant
                 , servant-client
                 , stm
                 , tasty
                 , template-haskell
                 , text
                 , time
                 , transformers
                 , websockets
                 , wuss

    default-language: GHC2024

    default-extensions: OverloadedStrings, TypeFamilies

test-suite meowbot-test
    type: exitcode-stdio-1.0

    hs-source-dirs: test

    ghc-options: -O0

    main-is: Main.hs

    other-modules: Test.ChatAPI

    build-depends: base
                 , tasty
                 , tasty-hunit
                 , mtl
                 , meowbot-lib
                 , http-client
                 , http-client-tls

    default-language: GHC2024

    default-extensions: OverloadedStrings
